
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Peformance comparaison</title>
  <meta name="description" content="">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://simpleflatmapper.org/12-csv-performance.html">
  <link rel="alternate" type="application/rss+xml" title="SimpleFlatMapper" href="http://simpleflatmapper.org/feed.xml">
</head>


<body>

<header class="site-header" role="banner">

    <div class="wrapper">

        <a class="site-title" href="/">SimpleFlatMapper</a>

        <nav class="site-nav">
            <a href="#" class="menu-icon">
                <svg viewBox="0 0 18 15" width="18px" height="15px">
                    <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
                    <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
                    <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
                </svg>
            </a>

            <div class="trigger">
                
                
                <a class="page-link" href="/01-getting-started.html">Getting Started</a>
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                <a class="page-link" href="/02-docs.html">Docs</a>
                
                
                
                
                
                
                
                <a class="page-link" href="/10-news.html">News</a>
                
                
                
                <a class="page-link" href="/11-v3-migration.html">Migrating to v3.</a>
                
                
                
                <a class="page-link" href="/12-csv-performance.html">Peformance comparaison</a>
                
                
                
                
                
                
                
                
                <a class="page-link" href="https://github.com/arnaudroger/SimpleFlatMapper/issues/new">Raise an issue</a>
            </div>
        </nav>



    </div>

    <a href="https://github.com/arnaudroger/SimpleFlatMapper"><img style="position: absolute; top: 0; left: 0; border: 0;" src="https://camo.githubusercontent.com/c6625ac1f3ee0a12250227cf83ce904423abf351/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f6c6566745f677261795f3664366436642e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_left_gray_6d6d6d.png"></a>

</header>





<main class="page-content" aria-label="Content">
    <div class="wrapper">
        <p><a href="https://github.com/arnaudroger/mapping-benchmark/blob/master/sfm-csv">Benchmark Code</a></p>

<h1 id="csv-parsing-unescapedescaped-and-parallel">Csv Parsing Unescaped/Escaped and Parallel</h1>

<p>The benchmark ran on a P500 Lenovo, result might differ - and do, ran on old i5, Univocity is faster than sfm.</p>

<p>The score are time in ms to parse the file, the lower the better. 
Univocity is the benchmark with readInputOnSeparateThread set to false, 
ConcurrentUnivocity has that flag set to true. 
All the parallel test appart from ConcurrentUnivocity uses a <a href="https://github.com/arnaudroger/SimpleFlatMapper/blob/master/sfm-util/src/main/java/org/simpleflatmapper/util/ParallelReader.java">ParallelReader</a>.</p>

<p>Why only those 3? because the other that I tested are pretty slow in compaison. If you think your csv parser is worth benchmark <a href="https://github.com/arnaudroger/mapping-benchmark/issues/new">Open an issue</a>.</p>

<h2 id="parsing-a-unescaped-csvhttpwwwmaxmindcomdownloadworldcitiesworldcitiespoptxtgz">Parsing a unescaped <a href="http://www.maxmind.com/download/worldcities/worldcitiespop.txt.gz">Csv</a></h2>

<table>
  <thead>
    <tr>
      <th>Parser</th>
      <th style="text-align: right">avgt</th>
      <th style="text-align: right">90th</th>
      <th style="text-align: right">95th</th>
      <th style="text-align: right">99th</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Jackson</td>
      <td style="text-align: right">1237</td>
      <td style="text-align: right">1281</td>
      <td style="text-align: right">1300</td>
      <td style="text-align: right">1346</td>
    </tr>
    <tr>
      <td>Sfm</td>
      <td style="text-align: right">854</td>
      <td style="text-align: right">858</td>
      <td style="text-align: right">859</td>
      <td style="text-align: right">865</td>
    </tr>
    <tr>
      <td>Univocity</td>
      <td style="text-align: right">958</td>
      <td style="text-align: right">969</td>
      <td style="text-align: right">974</td>
      <td style="text-align: right">994</td>
    </tr>
  </tbody>
</table>

<p><img src="/assets/perf/3.5/no_quotes.png" alt="Parce csv no quotes" /></p>

<h2 id="parsing-a-escaped-version-of-csvhttpwwwmaxmindcomdownloadworldcitiesworldcitiespoptxtgz">Parsing a escaped version of <a href="http://www.maxmind.com/download/worldcities/worldcitiespop.txt.gz">Csv</a></h2>

<table>
  <thead>
    <tr>
      <th>Parser</th>
      <th style="text-align: right">avgt</th>
      <th style="text-align: right">90th</th>
      <th style="text-align: right">95th</th>
      <th style="text-align: right">99th</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Jackson</td>
      <td style="text-align: right">1490</td>
      <td style="text-align: right">1726</td>
      <td style="text-align: right">1778</td>
      <td style="text-align: right">1810</td>
    </tr>
    <tr>
      <td>Sfm</td>
      <td style="text-align: right">1267</td>
      <td style="text-align: right">1502</td>
      <td style="text-align: right">1538</td>
      <td style="text-align: right">1550</td>
    </tr>
    <tr>
      <td>Univocity</td>
      <td style="text-align: right">1846</td>
      <td style="text-align: right">1883</td>
      <td style="text-align: right">1906</td>
      <td style="text-align: right">1963</td>
    </tr>
  </tbody>
</table>

<p><img src="/assets/perf/3.5/quotes.png" alt="Parce csv with quotes" /></p>

<h2 id="parsing-a-unescaped-csvhttpwwwmaxmindcomdownloadworldcitiesworldcitiespoptxtgz-with-parallelreaderhttpsgithubcomarnaudrogersimpleflatmapperblobmastersfm-utilsrcmainjavaorgsimpleflatmapperutilparallelreaderjava">Parsing a unescaped <a href="http://www.maxmind.com/download/worldcities/worldcitiespop.txt.gz">Csv</a> with <a href="https://github.com/arnaudroger/SimpleFlatMapper/blob/master/sfm-util/src/main/java/org/simpleflatmapper/util/ParallelReader.java">ParallelReader</a></h2>

<p>ConcurrentUnivocity uses readInputOnSeparateThread set to true and no ParallelReader.</p>

<table>
  <thead>
    <tr>
      <th>Parser</th>
      <th style="text-align: right">avgt</th>
      <th style="text-align: right">90th</th>
      <th style="text-align: right">95th</th>
      <th style="text-align: right">99th</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Jackson</td>
      <td style="text-align: right">1360</td>
      <td style="text-align: right">1545</td>
      <td style="text-align: right">1589</td>
      <td style="text-align: right">1875</td>
    </tr>
    <tr>
      <td>Sfm</td>
      <td style="text-align: right">749</td>
      <td style="text-align: right">825</td>
      <td style="text-align: right">891</td>
      <td style="text-align: right">999</td>
    </tr>
    <tr>
      <td>Univocity</td>
      <td style="text-align: right">852</td>
      <td style="text-align: right">895</td>
      <td style="text-align: right">965</td>
      <td style="text-align: right">1097</td>
    </tr>
    <tr>
      <td>ConcurrentUnivocity</td>
      <td style="text-align: right">795</td>
      <td style="text-align: right">806</td>
      <td style="text-align: right">813</td>
      <td style="text-align: right">849</td>
    </tr>
  </tbody>
</table>

<p><img src="/assets/perf/3.5/par_noquotes.png" alt="Parce csv, Parallel reader, no quotes" /></p>

<h2 id="parsing-a-escaped-version-of-csvhttpwwwmaxmindcomdownloadworldcitiesworldcitiespoptxtgz-with-parallelreaderhttpsgithubcomarnaudrogersimpleflatmapperblobmastersfm-utilsrcmainjavaorgsimpleflatmapperutilparallelreaderjava">Parsing a escaped version of <a href="http://www.maxmind.com/download/worldcities/worldcitiespop.txt.gz">Csv</a> with <a href="https://github.com/arnaudroger/SimpleFlatMapper/blob/master/sfm-util/src/main/java/org/simpleflatmapper/util/ParallelReader.java">ParallelReader</a></h2>

<p>ConcurrentUnivocity uses readInputOnSeparateThread set to true and no ParallelReader.</p>

<table>
  <thead>
    <tr>
      <th>Parser</th>
      <th style="text-align: right">avgt</th>
      <th style="text-align: right">90th</th>
      <th style="text-align: right">95th</th>
      <th style="text-align: right">99th</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Jackson</td>
      <td style="text-align: right">1368</td>
      <td style="text-align: right">1493</td>
      <td style="text-align: right">1560</td>
      <td style="text-align: right">1699</td>
    </tr>
    <tr>
      <td>Sfm</td>
      <td style="text-align: right">951</td>
      <td style="text-align: right">1048</td>
      <td style="text-align: right">1109</td>
      <td style="text-align: right">1230</td>
    </tr>
    <tr>
      <td>Univocity</td>
      <td style="text-align: right">1378</td>
      <td style="text-align: right">1480</td>
      <td style="text-align: right">1545</td>
      <td style="text-align: right">1828</td>
    </tr>
    <tr>
      <td>ConcurrentUnivocity</td>
      <td style="text-align: right">1302</td>
      <td style="text-align: right">1330</td>
      <td style="text-align: right">1365</td>
      <td style="text-align: right">1589</td>
    </tr>
  </tbody>
</table>

<p><img src="/assets/perf/3.5/par_quotes.png" alt="Parce csv, Parallel reader, with quotes" /></p>

<h1 id="summary">Summary</h1>

<p>Sfm is wining on all measures appart from the 90th percentile on unescaped parallel - That is likely link to the implementation of the ParallelReader.
The Sfm non parallel escaped reading is even faster than the ConcurrentUnivocity. and only 60ms behind on the non escaped content - might not worth wasting a cpu.</p>

<p>Jackson is better than Univocity on escaped content, Univocity is better than Jackson on unescaped.
For some reason the advantages that Jackson possesses disappear in the parallel treatment.</p>

<h1 id="number-of-rows-effect-on-parsingmapping-no-quotes">Number of rows effect on parsing/mapping no quotes</h1>

<p><a href="https://github.com/arnaudroger/mapping-benchmark/blob/master/sfm-csv/jmh-result-3.5-rows.csv">Raw Data</a></p>

<h2 id="row">1 row</h2>
<p><img src="/assets/perf/3.5/row_1.png" alt="1 Row" /></p>

<h2 id="rows">10 rows</h2>
<p><img src="/assets/perf/3.5/row_10.png" alt="10 Row" /></p>

<h2 id="rows-1">1000 rows</h2>
<p><img src="/assets/perf/3.5/row_1000.png" alt="1000 Row" /></p>

<h2 id="rows-2">100,000 rows</h2>
<p><img src="/assets/perf/3.5/row_100000.png" alt="100,000 Row" /></p>

<h2 id="m-rows">1.5m rows</h2>
<p><img src="/assets/perf/3.5/row_1_5m.png" alt="1.5m Row" /></p>

<h2 id="summary-1">Summary</h2>

<p>Sfm and Jackson have similar performances with small size files, Univocity has a fix cost that show on those file
make it not very suitable for those.
Using parallel for small size file is a bad idea.</p>

<p>Jackson mapper underperform and lag behind from 1000 rows. Sfm mapper is clearly in front on most sizes from 1000.</p>



        
    </div>
</main>

<footer class="site-footer">

    <div class="wrapper">

        <div class="footer-col-wrapper">
            <div class="footer-col footer-col-1">
                <ul class="contact-list">
                    <li>Contact</li>
                    <li><a href="mailto:arnaud.roger@gmail.com">arnaud.roger@gmail.com</a></li>
                </ul>
            </div>

            <div class="footer-col footer-col-2">
                <ul class="social-media-list">
                    <a href="https://github.com/arnaudroger/SimpleFlatMapper"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">arnaudroger/SimpleFlatMapper</span></a>
                </ul>
            </div>

            <div class="footer-col footer-col-3">
                <p></p>
            </div>
        </div>

    </div>
</footer>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59470416-1', 'auto');
  ga('send', 'pageview');

</script>



</body>

</html>